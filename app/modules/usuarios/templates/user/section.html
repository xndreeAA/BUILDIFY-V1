{% extends "layout-user.html" %}

{% block styles %}
{{ super() }}
<meta name="csrf-token" content="{{ csrf_token() }}">
<link rel="stylesheet" href="{{ url_for('web_v1.user.static', filename='user/css/categorias.css') }}">
<link rel="stylesheet" href="{{ url_for('web_v1.user.static', filename='user/css/btn_styled.css') }}">
{% endblock %}

{% block content %}
<div class="categorias">
    <div class="volver">
        <p id="home_link">
            ← Regresar al home <a href="{{ url_for('web_v1.user.home') }}">Volver</a>
        </p>
    </div>

    <!-- El atributo data-categoria se usa en filtros.js -->
    <h1 id="title_categorias" data-categoria="{{ category|lower }}">
        Productos de {{ category | upper }}
    </h1>

    <!-- Filtros -->
    <div class="filtros">
        <label for="marca">Filtrar por marca:</label>
        <select id="marca">
            <option value="">Todas</option>
            <!-- Opciones dinámicas cargadas desde JS -->
        </select>
        <button id="aplicar-filtro">Aplicar</button>
    </div>

    {% if products %}
    <div class="products-container">
        {% for product in products %}
        <div class="cards_container">
            <!-- Columna izquierda -->
            <div class="product-left">
                <a href="{{ url_for('web_v1.user.product_details', id=product['id_producto']) }}">
                    {% if product['imagenes'] and product['imagenes'][0]['ruta'] %}
                    <img src="{{ product['imagenes'][0]['ruta'] }}" alt="{{ product['nombre'] }}" />
                    {% else %}
                    <img src="{{ url_for('static', filename='img/default-product.png') }}" alt="Sin imagen" />
                    {% endif %}
                </a>
                <div class="product-info">
                    <p class="categoria">{{ category }}</p>
                    <a href="{{ url_for('web_v1.user.product_details', id=product['id_producto']) }}">
                        <h3>{{ product['nombre'] }}</h3>
                    </a>
                    <p class="comentarios">0 Comentarios · <a href="#">Escriba un comentario</a></p>
                </div>
            </div>

            <!-- Columna derecha -->
            <div class="product-right">
                <div class="precio">
                    <p>${{ "{:,.0f}".format(product['precio']) }}</p>
                </div>
                <hr>
                <div class="cantidad">
                    <label for="cantidad-{{ product['id_producto'] }}">Cantidad</label>
                    <div class="cantidad-input">
                        <input type="number" id="cantidad-{{ product['id_producto'] }}" name="cantidad" value="1"
                            min="1" max="{{ product['stock'] }}" />
                    </div>
                </div>
                <div class="boton_agregar_producto">
                    <button class="btn-styled btn-agregar" data-id="{{ product['id_producto'] }}">
                        + Añadir al carrito
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>No hay productos en esta categoría.</p>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('web_v1.carrito.static', filename='js/añadir_producto.js') }}"></script>
<script src="{{ url_for('web_v1.user.static', filename='user/js/filtros.js') }}"></script>
{% endblock %}
